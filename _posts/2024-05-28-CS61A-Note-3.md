---
layout: post
title:  "CS61A-Note-3"
date:   2024-05-28 16:55:00 +0100
categories: Note
tags: CS61A 
---

Notes on [CS61A-2024](https://cs61a.org/) Week 7: Iterators and Generators.

# Implicit Sequences

ä¸€ä¸ªåºåˆ—å¯ä»¥åœ¨è®¡ç®—æœºçš„å†…å­˜ä¸­ä¸æ˜¾å¼å­˜å‚¨æ¯ä¸ªå…ƒç´ ï¼Œè¿™æ„å‘³ç€åºåˆ—çš„å…ƒç´ ä¸éœ€è¦é€ä¸ªå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè€Œæ˜¯é€šè¿‡æŸç§è®¡ç®—æˆ–è§„åˆ™åœ¨éœ€è¦æ—¶åŠ¨æ€ç”Ÿæˆã€‚

### Example

Lazy computation: æ ¹æ®éœ€è¦è®¡ç®—å€¼ï¼Œè€Œä¸æ˜¯ä»ç°æœ‰è¡¨ç¤ºä¸­æ£€ç´¢å€¼ã€‚

```python
>>> r = range(10000, 1000000000)
>>> r[45006230]
45016230
```

# Iterators

è¿­ä»£å™¨æ˜¯ä¸€ç§éšå¼è¡¨ç¤ºåºåˆ—çš„æ–¹æ³•ã€‚

AnÂ *iterator*Â is an object that provides sequential access to values, one by one.

- For any container, such as a list or range, an iterator can be obtained by calling the built-inÂ `iter`Â function.

### Components

ä¸€ç§ç”¨äºæ£€ç´¢æ­£åœ¨å¤„ç†çš„åºåˆ—ä¸­ä¸‹ä¸€ä¸ªå…ƒç´ çš„æœºåˆ¶ã€‚

ä¸€ç§ç”¨äºå‘å‡ºä¿¡å·è¡¨æ˜ä»¥è¾¾åˆ°åºåˆ—æœ«å°¾ä¸”æ²¡æœ‰æ›´å¤šå…ƒç´ çš„æœºåˆ¶ã€‚

### Iterator Interface

Python è¿­ä»£å™¨æ¥å£æ˜¯ä½¿ç”¨`__next__`æ¥å®šä¹‰çš„ï¼Œè¯¥æ–¹æ³•è¿”å›è¡¨ç¤ºå…¶ä¸‹å±‚åºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚Python é€šè¿‡åœ¨è°ƒç”¨Â `__next__`Â æ—¶å¼•å‘Â **StopIteration**Â å¼‚å¸¸æ¥è¡¨ç¤ºå·²ç»åˆ°è¾¾ä¸‹å±‚åºåˆ—çš„æœ«å°¾ã€‚

### Example

```python
>>> primes = [2, 3, 5, 7]
>>> type(primes)
>>> iterator = iter(primes)
>>> type(iterator)
>>> next(iterator)
2
>>> next(iterator)
3
>>> next(iterator)
5
```

å¦‚æœæ£€æµ‹åˆ°æ²¡æœ‰æ›´å¤šå…ƒç´ äº†ï¼Œ`next`å‡½æ•°ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿™ç§æƒ…å†µã€‚

```python
>>> try:
        next(iterator)
    except StopIteration:
        print('No more values')
No more values
```

ä¸¤ä¸ªå•ç‹¬çš„è¿­ä»£å™¨å¯ä»¥è·Ÿè¸ªåŒä¸€åºåˆ—ä¸­çš„ä¸¤ä¸ªä¸åŒä½ç½®ï¼Œæ¨è¿›ç¬¬äºŒä¸ªè¿­ä»£å™¨ä¸ä¼šå½±å“ç¬¬ä¸€ä¸ªã€‚ä½†å¯¹äºåŒä¸€ä¸ªè¿­ä»£å™¨çš„ä¸¤ä¸ªåç§°å°†å…±äº«ä¸€ä¸ªä½ç½®ï¼Œå› ä¸ºå®ƒä»¬å…±äº«ç›¸åŒçš„å€¼ã€‚

```python
>>>r = range(3, 13)
>>>s = iter(r)# 1st iterator over r>>>next(s)
3
>>>next(s)
4
>>>t = iter(r)# 2nd iterator over r>>>next(t)
3
>>>next(t)
4
>>>u = t# Alternate name for the 2nd iterator>>>next(u)
5
>>>next(u)
6
>>> next(s)
5
>>> next(t)
7
```

åœ¨è¿­ä»£å™¨ä¸Šè°ƒç”¨`iter`å°†è¿”å›è¯¥è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯å‰¯æœ¬ã€‚

```python
>>> v = iter(t)  # Another alterante name for the 2nd iterator
>>> next(v)
8
>>> next(u)
9
>>> next(t)
10
```

è¿­ä»£å™¨æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ä¾æ¬¡å¤„ç†ä¸€ç³»åˆ—å€¼ä¸­çš„æ¯ä¸€ä¸ªï¼Œè€Œæ— éœ€åŒæ—¶å­˜å‚¨æ‰€æœ‰è¿™äº›å…ƒç´ ã€‚

<aside>
ğŸ§€ &nbsp; è¿­ä»£å™¨æ˜¯å¯å˜çš„ï¼ˆMutableï¼‰ï¼Œå› ä¸ºå®ƒä»¬åœ¨éå†ä¸€ä¸ªåºåˆ—æ—¶ä¼šè·Ÿè¸ªå½“å‰çš„ä½ç½®ã€‚æ¯æ¬¡è¯·æ±‚ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿­ä»£å™¨éƒ½ä¼šæ›´æ–°å…¶å†…éƒ¨çŠ¶æ€ï¼Œä»¥ç¡®ä¿è¿”å›ä¸‹ä¸€ä¸ªæ­£ç¡®çš„å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹è¿­ä»£å™¨ä¸ä¼šè¢«é‡ç½®ï¼Œè€Œæ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ¥å¼€å§‹æ–°çš„è¿­ä»£ã€‚

</aside>

## 1. Iterables

ä»»ä½•èƒ½äº§ç”Ÿè¿­ä»£å™¨çš„å€¼éƒ½è¢«ç§°ä¸ºå¯è¿­ä»£å€¼ï¼ˆIterablesï¼‰ã€‚

å¯è¿­ä»£å¯¹è±¡åŒ…æ‹¬é›†åˆæˆ–åºåˆ—ç±»å‹ï¼ˆå¦‚`list`ã€`tuple`ã€`set`ã€`dict`ã€`str`ï¼‰ï¼Œä»¥åŠè¿­ä»£å™¨æœ¬èº«ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥èƒŒä¼ é€’ç»™`iter`å‡½æ•°ã€‚

è¿­ä»£å™¨å¯ä»¥æ¥å—æ— åºé›†åˆï¼Œä½†æ˜¯è¿™äº›æ— åºé›†åˆï¼ˆå¦‚`set`ã€`dict`ï¼‰åœ¨ç”Ÿæˆè¿­ä»£å™¨æ—¶ä¹Ÿå¿…é¡»å®šä¹‰ä¸€ä¸ªé¡ºåºï¼Œä»¥ä¾¿è¿­ä»£å™¨å¯ä»¥ä¾æ¬¡è¿”å›é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚

## 2. Built-in Iterators

ä¸€äº›å†…ç½®å‡½æ•°å¯ä»¥ä»¥å¯è¿­ä»£å€¼ä¸ºå‚æ•°ï¼Œè¿”å›è¿­ä»£å™¨ï¼ˆå¦‚`map`ã€`zip` ã€`reversed`ã€ `filter`ï¼‰ã€‚è¿™äº›å‡½æ•°è¢«å¹¿æ³›ç”¨äºæƒ°æ€§åºåˆ—å¤„ç†ã€‚

### Example

è°ƒç”¨`map`ä¸ä¼šæ‰§è¡Œè®¡ç®—æ‰€éœ€çš„è®¡ç®—å…ƒç´ çš„æ“ä½œï¼Œä½†å°†åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚è¯¥å¯¹è±¡å¯ä»¥åœ¨ä½¿ç”¨Â `next`Â æŸ¥è¯¢æ—¶è¿”å›ç»“æœã€‚

```python
>>> def double_and_print(x):
        print('***', x, '=>', 2*x, '***')
        return 2*x
>>> s = range(3, 7)
>>> doubled = map(double_and_print, s)  # double_and_print not yet called
>>> next(doubled)                       # double_and_print called once
*** 3 => 6 ***
6
>>> next(doubled)                       # double_and_print called again
*** 4 => 8 ***
8
>>> list(doubled)                       # double_and_print called twice more
*** 5 => 10 ***
*** 6 => 12 ***
[10, 12]
```

## 3. For Statements

Objects areÂ *iterable*Â (an interface) if they have anÂ `__iter__`Â method that returns anÂ *iterator*. TheÂ `for`Â statement in Python operates on iterators. 

```python
for <name> in <expression>:
    <suite>
```

### Example

```python
>>> counts = [1, 2, 3]
>>> for item in counts:
        print(item)
```

ä¸Šè¿°ä»£ç ç­‰ä»·äºï¼š

```python
>>> items = counts.__iter__()
>>> try:
        while True:
            item = items.__next__()
            print(item)
    except StopIteration:
        pass
```

# Generators

å¯¹äºå¤æ‚åºåˆ—æ¥è¯´ï¼Œ`__next__`Â æ–¹æ³•è¦ä¿å­˜å…¶åœ¨è®¡ç®—ä¸­çš„ä½ç½®å¯èƒ½ä¼šç›¸å½“å›°éš¾ã€‚è€Œç”Ÿæˆå™¨å…è®¸æˆ‘ä»¬é€šè¿‡åˆ©ç”¨ Python è§£é‡Šå™¨çš„ç‰¹æ€§æ¥å®šä¹‰æ›´å¤æ‚çš„è¿­ä»£ã€‚å®ƒå¯ä»¥è¢«çœ‹ä½œä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ã€‚

## 1. Generator function

AÂ *generator*Â is an iterator returned by a special class of function called aÂ *generator function*. 

- ç”Ÿæˆå™¨å‡½æ•°ä¸å¸¸è§„å‡½æ•°æœ‰æ‰€ä¸åŒï¼Œå®ƒä»¬çš„ä¸»ä½“ä¸åŒ…å«Â **return**Â è¯­å¥ï¼Œè€Œæ˜¯ä½¿ç”¨Â **yield**Â è¯­å¥è¿”å›ç³»åˆ—çš„å…ƒç´ ã€‚
- è¯¥å‡½æ•°åœ¨æ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„Â `__next__`Â æ–¹æ³•æ—¶è¿è¡Œï¼Œç›´åˆ°æ‰§è¡Œä¸‹ä¸€ä¸ªÂ `yield`Â è¯­å¥ä¸ºæ­¢ã€‚`yield` ä¼šæš‚åœå¹¶è¿”å›å½“å‰å€¼ã€‚
- å½“å†æ¬¡è°ƒç”¨Â `__next__`Â æ—¶ï¼Œæ‰§è¡Œå°†ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹æ¢å¤ã€‚Â å½“å‰å€¼ä»¥åŠÂ å‡½æ•°ä½œç”¨åŸŸä¸­çš„ä»»ä½•å…¶ä»–ç»‘å®šåç§°çš„å€¼å°†åœ¨åç»­è°ƒ `__next__`Â æ—¶ä¿ç•™ã€‚

```python
>>> def letters_generator():
        current = 'a'
        while current <= 'd':
            yield current
            current = chr(ord(current)+1)
>>> for letter in letters_generator():
        print(letter)
a
b
c
d
```

### ç”Ÿæˆå™¨ä¸è¿­ä»£å™¨çš„åŒºåˆ«

- è¿­ä»£å™¨æ˜¯è®¿é—®å®¹å™¨çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒæ˜¯ä»å·²æœ‰å…ƒç´ æ‹“å°å‡ºä¸€ä»½å‰¯æœ¬ï¼Œåªä¸ºæ­¤æ¬¡è¿­ä»£ä½¿ç”¨ã€‚è€Œç”Ÿæˆå™¨åˆ™åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿæ–°çš„è¿”å›å€¼ã€‚
- ç”Ÿæˆå™¨åªèƒ½éå†ä¸€æ¬¡ã€‚

### **Returnä¸yieldçš„åŒºåˆ«**

- ç›¸åŒç‚¹ï¼šä¸¤è€…éƒ½è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚
- ä¸åŒç‚¹ï¼šreturn åœ¨è¿”å›ç»“æœåç»ˆæ­¢å‡½æ•°çš„è¿è¡Œï¼Œè€Œ yield åˆ™å°†å‡½æ•°è½¬ä¸ºç”Ÿæˆå™¨ã€‚

# Stream

é™¤äº†è¿­ä»£å™¨ä»¥å¤–ï¼Œæµæä¾›äº†å¦ä¸€ç§éšå¼è¡¨ç¤ºé¡ºåºæ•°æ®çš„æ–¹å¼ã€‚

<aside>
âœ‚ï¸ &nbsp; A stream is a lazily computed linked list.

</aside>

åœ¨æµä¸­ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆ`first`ï¼‰æ˜¯ç«‹å³å¯ç”¨çš„ï¼Œè€Œå…¶ä½™éƒ¨åˆ†ï¼ˆ`rest`ï¼‰æ˜¯ä¸€ä¸ªæƒ°æ€§æ±‚å€¼çš„æµã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`rest` åªæœ‰åœ¨ä½ å®é™…è¯·æ±‚å®ƒæ—¶æ‰ä¼šè¢«è®¡ç®—ã€‚

```python
>>> class Stream:
        """A lazily computed linked list."""
        class empty:
            def __repr__(self):
                return 'Stream.empty'
        empty = empty()
        def __init__(self, first, compute_rest=lambda: empty):
            assert callable(compute_rest), 'compute_rest must be callable.'
            self.first = first
            self._compute_rest = compute_rest
        @property
        def rest(self):
            """Return the rest of the stream, computing it if necessary."""
            if self._compute_rest is not None:
                self._rest = self._compute_rest()
                self._compute_rest = None
            return self._rest
        def __repr__(self):
            return 'Stream({0}, <...>)'.format(repr(self.first))
```

```python
>>> s = Stream(1, lambda: Stream(2+3, lambda: Stream(9)))
>>> s.first
1
>>> s.rest.first
5
>>> s.rest
Stream(5, <...>)
```

æµä¸è¿­ä»£å™¨ç›¸æ¯”çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬å¯ä»¥å¤šæ¬¡ä¼ é€’ç»™çº¯å‡½æ•°ï¼Œå¹¶ä¸”æ¯æ¬¡äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚

<aside>
ğŸ§€ &nbsp; æ€»ç»“ä¸€ä¸‹ï¼šè¿­ä»£å™¨æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè€Œæµå¯ä»¥é‡å¤ä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºè¿­ä»£å™¨åœ¨éå†å…¶å…ƒç´ æ—¶ä¼šæ¶ˆè€—å®ƒä»¬ï¼Œè¿™ä¼šæ”¹å˜å…¶å†…éƒ¨çŠ¶æ€ï¼Œæ¯æ¬¡éå†çš„ç»“æœå¯èƒ½ä¼šä¸åŒã€‚è€Œæµçš„å…ƒç´ æ˜¯åœ¨éœ€è¦æ—¶è®¡ç®—çš„ï¼Œè¿™ä½¿å¾—æµæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥é‡æ–°è®¡ç®—çš„åºåˆ—ã€‚ä¸”é‡æ–°è®¡ç®—æ—¶ä¸ä¼šæ”¹å˜æµå†…éƒ¨çŠ¶æ€ï¼Œè¿™ç¡®ä¿äº†è¾“å‡ºçš„ä¸€è‡´æ€§ã€‚

</aside>